(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/home/chat/chat"],{"0644":function(e,t,o){"use strict";var i=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){e.active=1},e.e1=function(t){e.active=2},e.e2=function(t){e.active=3},e.e3=function(t){e.active=4},e.e4=function(t){e.active=5},e.e5=function(t){e.footer_enable,e.footer_enable=1})},s=[];o.d(t,"a",function(){return i}),o.d(t,"b",function(){return s})},"3f43":function(e,t,o){},"7ce7":function(module,exports,__webpack_require__){"use strict";(function(uni){Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vuex=__webpack_require__("2f62");function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{},i=Object.keys(o);"function"===typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),i.forEach(function(t){_defineProperty(e,t,o[t])})}return e}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var uniNumberBox=function(){return __webpack_require__.e("components/uni-number-box/uni-number-box").then(__webpack_require__.bind(null,"10a9"))},_default={components:{uniNumberBox:uniNumberBox},data:function(){return{diyStyle:"",room_id:0,socket:"",isConnect:!1,historyList:[],messageList:[],down:!1,rotate:45,active:1,footer_enable:2,isSealed:0,game:{four:{},group:{},number:[],extremum:{},dragon_tiger_balm:{}},interval:null,robot:null,total_money:0,end_time_str:"",end_time:"",next_periods:"正在获取期号",next_periods_id:0,previous_periods_id:"",previous_periods:"",previous_periods_result_text:"",previous_periods_result_one:"",previous_periods_result_two:"",previous_periods_result_three:"",previous_periods_result:"",previous_periods_result_type:"",isRun:!1,isSendOpenResult:!0}},computed:_objectSpread({},(0,_vuex.mapGetters)({userInfo:"userInfo",token:"token",expri:"expri",periodsInfo:"periodsInfo"})),methods:{footerdown:function(){1==this.footer_enable?this.footer_enable=2:this.footer_enable,this.game={four:{},group:{},number:[],extremum:{},dragon_tiger_balm:{}},this.total_money=0},countDown:function(){},bindChange:function(e){if(!this.next_periods||!this.next_periods_id)return this.toast("期数错误, 暂时不能投"),!1;1==e.type?this.game_four(e):2==e.type?this.game_group(e):3==e.type?this.game_number(e):4==e.type?this.game_extremum(e):5==e.type&&this.game_dragon_tiger_balm(e);var t=0;for(var o in this.game.four)t+=this.game.four[o].money;for(var i in this.game.group)t+=this.game.group[i].money;for(var s=0;s<this.game.number.length;s++)t+=this.game.number[s].money;for(var n in this.game.extremum)t+=this.game.extremum[n].money;for(var a in this.game.dragon_tiger_balm)t+=this.game.dragon_tiger_balm[a].money;this.total_money=t},game_four:function(e){var t={odd:e.odd,money:e.money};1==e.index?t.money<=0?delete this.game.four.da:this.game.four.da=t:2==e.index?t.money<=0?delete this.game.four.xiao:this.game.four.xiao=t:3==e.index?t.money<=0?delete this.game.four.dan:this.game.four.dan=t:4==e.index&&(t.money<=0?delete this.game.four.shuang:this.game.four.shuang=t)},game_group:function(e){var t={odd:e.odd,money:e.money};1==e.index?t.money<=0?delete this.game.group.dadan:this.game.group.dadan=t:2==e.index?t.money<=0?delete this.game.group.xiaodan:this.game.group.xiaodan=t:3==e.index?t.money<=0?delete this.game.group.dashuang:this.game.group.dashuang=t:4==e.index&&(t.money<=0?delete this.game.group.xiaoshuang:this.game.group.xiaoshuang=t)},game_number:function(e){var t,o={number:e.index,odd:e.odd,money:e.money},i=this.game.number;if(i.length>0){for(var s=0;s<i.length;s++)i[s]&&i[s].number==e.index?(t=!1,o.money<=0?i.splice(s,1):i[s]=o):t=!0;t&&o.money>0&&i.push(o)}else o.money>0&&i.push(o);this.game.number=i},game_extremum:function(e){var t={odd:e.odd,money:e.money};1==e.index?t.money<=0?delete this.game.extremum.jida:this.game.extremum.jida=t:2==e.index&&(t.money<=0?delete this.game.extremum.jixiao:this.game.extremum.jixiao=t)},game_dragon_tiger_balm:function(e){var t={odd:e.odd,money:e.money};1==e.index?t.money<=0?delete this.game.dragon_tiger_balm.dragon:this.game.dragon_tiger_balm.dragon=t:2==e.index?t.money<=0?delete this.game.dragon_tiger_balm.tiger:this.game.dragon_tiger_balm.tiger=t:3==e.index?t.money<=0?delete this.game.dragon_tiger_balm.balm:this.game.dragon_tiger_balm.balm=t:4==e.index?t.money<=0?delete this.game.dragon_tiger_balm.duizi:this.game.dragon_tiger_balm.duizi=t:5==e.index?t.money<=0?delete this.game.dragon_tiger_balm.shunzi:this.game.dragon_tiger_balm.shunzi=t:6==e.index&&(t.money<=0?delete this.game.dragon_tiger_balm.baozi:this.game.dragon_tiger_balm.baozi=t)},dropdown:function(){this.down?(this.down=!1,this.rotate=45):(this.down=!0,this.rotate=135)},connection:function(){if(!this.room_id)return this.toast("房间id错误"),uni.switchTab({url:"../home"}),!1;var e=this;this.socket=uni.connectSocket({url:this.socket_host+"?room_id="+this.room_id,header:{"content-type":"application/json",room_id:this.room_id},method:"GET",success:function(t){e.isConnect=!0,console.log(t,"连接成功"," at pages\\home\\chat\\chat.vue:567")},fail:function(e){console.log("连接错误:",e," at pages\\home\\chat\\chat.vue:571")}}),this.open(),this.message(),this.error()},open:function(){this.socket.onOpen(function(e){console.log("WebSocket连接已打开！"+e," at pages\\home\\chat\\chat.vue:584")})},message:function message(){var _this=this;this.socket.onMessage(function(res){console.log("服务端发来了消息=============start"," at pages\\home\\chat\\chat.vue:591"),console.log(res," at pages\\home\\chat\\chat.vue:592");var content=eval("("+res.data+")");console.log(content," at pages\\home\\chat\\chat.vue:595"),1==content.status&&_this.messageList.push(content),console.log("总的消息列表=============end"," at pages\\home\\chat\\chat.vue:602"),console.log(_this.messageList," at pages\\home\\chat\\chat.vue:603"),console.log("服务端发来了消息=============end"," at pages\\home\\chat\\chat.vue:604")})},error:function(){this.socket.onError(function(e){})},send:function(){if(!this.room_id)return this.toast("房间id错误, 不能投注"),!1;if(0==this.isRun)return this.toast("已封盘"),!1;if(!this.next_periods||!this.next_periods_id)return this.toast("期号错误"),!1;var e=JSON.stringify(this.game),t=JSON.stringify(this.game.four),o=JSON.stringify(this.game.group),i=JSON.stringify(this.game.number),s=JSON.stringify(this.game.extremum),n=JSON.stringify(this.game.dragon_tiger_balm);if(console.log(e," at pages\\home\\chat\\chat.vue:636"),console.log(t," at pages\\home\\chat\\chat.vue:637"),console.log(o," at pages\\home\\chat\\chat.vue:638"),console.log(i," at pages\\home\\chat\\chat.vue:639"),console.log(s," at pages\\home\\chat\\chat.vue:640"),console.log(n," at pages\\home\\chat\\chat.vue:641"),"{}"==e||"{}"==t&&"{}"==o&&"[]"==i&&"{}"==s&&"{}"==n)return this.toast("请选择玩法并且投注金额, 再下注"),!1;if(this.userInfo.user.balance<=0)return this.toast("余额不足, 请充值后再玩"),!1;console.log(this.game," at pages\\home\\chat\\chat.vue:655");var a=this,r={type:1,total_money:this.total_money,periods_id:this.next_periods_id,periods:this.next_periods,user_id:this.userInfo.user.id,username:this.userInfo.user.username,room_id:this.room_id,data:this.game},h=JSON.stringify(r);this.socket.send({data:h,success:function(e){console.log(e," at pages\\home\\chat\\chat.vue:675"),a.getUserInfo(this),a.footerdown()},fail:function(e){console.log("发送错误============start"," at pages\\home\\chat\\chat.vue:680"),console.log(e," at pages\\home\\chat\\chat.vue:681"),console.log("发送错误============end"," at pages\\home\\chat\\chat.vue:682")}})},getHistory:function(){var e=this;this.httpRequest("chat/history","GET",{},function(t){if(200!=t.data.code)return e.toast(t.data.message),!1;if(e.historyList=t.data.data,e.historyList.length>0){e.previous_periods=e.historyList[0].periods,e.previous_periods_id=e.historyList[0].id;var o=e.historyList[0].open_number.split("+");e.previous_periods_result_one=o[0],e.previous_periods_result_two=o[1],e.previous_periods_result_three=o[2],e.previous_periods_result=e.historyList[0].open_number_sum;var i="无";e.historyList[0].duishunbao&&(i=e.historyList[0].duishunbao),e.previous_periods_result_text=e.historyList[0].open_number+"="+e.historyList[0].open_number_sum+" ("+i+")",i.length>=2&&(i=i.substr(0,i.length-1)),e.previous_periods_result_type=i}})},getMessageList:function(){var e=this;this.httpRequest("chat/get-chat-record","GET",{room_id:this.room_id},function(t){if(console.log("这是消息记录start================================="," at pages\\home\\chat\\chat.vue:728"),console.log("这是消息记录end================================="," at pages\\home\\chat\\chat.vue:730"),200==t.data.code){if(t.data.data.forEach(function(t,o){e.messageList.unshift(t)}),e.isRun){var o={type:2,date_time:"2019-08-04 23:01:26",id:"996",number_text:"10小 ",periods:"2458148",periods_id:"985",total_money:"10.00",user_id:"8",username:"大不溜"};e.messageList.push(o)}console.log("这是消息记录start+++++++++++++++++++++++++++++++"," at pages\\home\\chat\\chat.vue:753"),console.log(e.messageList," at pages\\home\\chat\\chat.vue:754"),console.log("这是消息记录end----------------------------------"," at pages\\home\\chat\\chat.vue:755")}else e.toast("error")})},sendOpenResultMessage:function(){if(this.isSendOpenResult)return!1;var e={type:3,total_money:"",periods_id:this.historyList[0].id,periods:this.historyList[0].periods,user_id:this.userInfo.user.id,username:this.userInfo.user.username,room_id:this.room_id,data:this.previous_periods_result_text};console.log("type3消息"," at pages\\home\\chat\\chat.vue:776"),console.log(e," at pages\\home\\chat\\chat.vue:777");var t=JSON.stringify(e),o=this;this.socket.send({data:t,success:function(e){console.log(e," at pages\\home\\chat\\chat.vue:784"),o.isSendOpenResult=!0},fail:function(e){console.log("发送错误============start"," at pages\\home\\chat\\chat.vue:788"),console.log(e," at pages\\home\\chat\\chat.vue:789"),console.log("发送错误============end"," at pages\\home\\chat\\chat.vue:790")}})},getCurrentPeriods:function(){if(this.isRun)return!1;if(!this.room_id)return this.toast("房间错误"),!1;var e=this,t=Math.round(new Date/1e3);this.httpRequest("chat/get-current-periods","GET",{room_id:this.room_id},function(o){200==o.data.code?(console.log(o.data.data.end_time,t," at pages\\home\\chat\\chat.vue:808"),o.data.data&&o.data.data.end_time&&o.data.data.end_time>t&&(e.$store.commit("periodsInfo",o.data.data),e.next_periods=o.data.data.periods,e.next_periods_id=o.data.data.id,e.isRun=!0,e.isSendOpenResult=!1,e.getHistory())):210==o.data.code&&e.messageList.push({type:2})})},intervalEndTime:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(console.log(e," at pages\\home\\chat\\chat.vue:828"),!this.room_id)return this.toast("房间错误"),!1;this.next_periods=this.periodsInfo.periods,this.next_periods_id=this.periodsInfo.id;var t=this;this.interval=setInterval(function(){t.endTimeStr()},1e3)},endTimeStr:function(){var e=Math.round(new Date/1e3),t=this.periodsInfo.end_time-e-10;if("Nan"!=t&&t>=0){parseInt(t/60/60/24,10),parseInt(t/60/60%24,10);var o=parseInt(t/60%60,10),i=parseInt(t%60,10);o=this.checkTime(o),i=this.checkTime(i),this.end_time_str=o+"分"+i+"秒",0==t?this.isRun=!1:this.isRun||(this.isRun=!0)}else this.isRun||this.periodsInfo.end_time&&!(this.periodsInfo.end_time<e-12)?(this.messageList.length>0&&this.messageList[this.messageList.length-1].periods!=this.next_periods&&this.robotSend(2),console.log("时间是",this.periodsInfo.end_time,e," at pages\\home\\chat\\chat.vue:881")):(console.log("走进请求数据:",this.periodsInfo," at pages\\home\\chat\\chat.vue:866"),this.isRun=!1,this.getCurrentPeriods())},checkTime:function(e){return e<10?"0"+e:e},robotSend:function(e){if(2!=e)return!1;if(this.messageList&&this.messageList.length>0&&this.messageList[0]&&this.messageList[0].periods==this.next_periods)return!1;var t={xiao:{odd:2,money:10},shuang:{odd:2,money:10},dan:{odd:2,money:10},da:{odd:2,money:10}},o=_defineProperty({dadan:{odd:4.2,money:10},xiaoshuang:{odd:4.4,money:10},xiaodan:{odd:4.4,money:10}},"xiaodan",{odd:4.4,money:10}),i=[],s={},n={four:t,group:o,number:[],extremum:i,dragon_tiger_balm:s},a={type:2,total_money:888,periods_id:this.next_periods_id?this.next_periods_id:99,periods:this.next_periods?this.next_periods:100,user_id:9999,username:"花不脱",room_id:this.room_id,data:n},r=JSON.stringify(a);this.socket.send({data:r,success:function(e){console.log(e," at pages\\home\\chat\\chat.vue:945")},fail:function(e){console.log("发送错误============start"," at pages\\home\\chat\\chat.vue:949"),console.log(e," at pages\\home\\chat\\chat.vue:950"),console.log("发送错误============end"," at pages\\home\\chat\\chat.vue:951")}})},randomNum:function(e,t){switch(arguments.length){case 1:return parseInt(Math.random()*e+1,10);case 2:return parseInt(Math.random()*(t-e+1)+e,10);default:return 0}},scrollToBottom:function(){var e=this;this.$nextTick(function(){var t=e.$el.querySelector(".content");console.log("container.scrollHeight:",t," at pages\\home\\chat\\chat.vue:971")})}},onLoad:function(e){if(!e.room_id)return this.toast("房间错误"),uni.switchTab({url:"../home"}),!1;this.room_id=e.room_id,this.getUserInfo();var t=Math.round(new Date/1e3);if(!this.userInfo.user||!this.token||this.expri<t)return this.toast("登录过期!!"),this.$store.commit("logout"),setTimeout(function(){uni.redirectTo({url:"/pages/ucenter/Login/Login"})},1e3),!1;this.connection(),this.getHistory(),this.getMessageList(),this.intervalEndTime(),this.diyStyle="top: 82upx;","android"==uni.getSystemInfoSync().platform&&(this.diyStyle="top: 0upx;"),this.scrollToBottom()},onShow:function(){},onHide:function(){},onUnload:function(){clearInterval(this.interval)}};exports.default=_default}).call(this,__webpack_require__("6e42")["default"])},af8f:function(e,t,o){"use strict";o.r(t);var i=o("0644"),s=o("c4ca");for(var n in s)"default"!==n&&function(e){o.d(t,e,function(){return s[e]})}(n);o("c6d6");var a=o("2877"),r=Object(a["a"])(s["default"],i["a"],i["b"],!1,null,null,null);t["default"]=r.exports},c4ca:function(e,t,o){"use strict";o.r(t);var i=o("7ce7"),s=o.n(i);for(var n in i)"default"!==n&&function(e){o.d(t,e,function(){return i[e]})}(n);t["default"]=s.a},c6d6:function(e,t,o){"use strict";var i=o("3f43"),s=o.n(i);s.a}},[["bc47","common/runtime","common/vendor"]]]);